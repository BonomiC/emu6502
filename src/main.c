#include <stdio.h>
#include "cpu.h"

#define ADD_INSTRUCTION(...) add_instruction((uint8_t[]){__VA_ARGS__}, sizeof((uint8_t[]){__VA_ARGS__}))

void add_instruction(uint8_t *instructions, uint8_t size)
{
    static uint16_t ram_pos = 0x0600;
    memcpy(mainMemory + ram_pos, instructions, size);
    ram_pos += size;
}

int main(int argc, char** argv)
{
    initialize();

    context.pc = 0x0600;

    // ADD_INSTRUCTION(0xA9, 27); // LDA #27

    // ADD_INSTRUCTION(0xAD, 0xCD, 0xAB); // LDA $ABCD

    // ADD_INSTRUCTION(0x69, 0xA); // ADC #10

    // ADD_INSTRUCTION(0xA2, 0x10); // LDX #10

    // ADD_INSTRUCTION(0x65, 0xBF); // ADC $BF

    // ADD_INSTRUCTION(0x75, 0xAF); // ADC $AF,X

    // ADD_INSTRUCTION(0x0A); // ASL

    // ADD_INSTRUCTION(0x06, 0xCD); // ASL $CD

    // ADD_INSTRUCTION(0xA4, 0xCD); // LDY $CD

    // ADD_INSTRUCTION(0x90, -6); // BCC -6 // Will cause loop prev 2 instructions until carry bit is set

    // mainMemory[0xABCD] = 195;
    // mainMemory[0x00BF] = 20;
    // mainMemory[0x00CD] = 17;

    // ADD_INSTRUCTION(
    //     0xA9,
    //     0x05,
    //     0xA2,
    //     0x03,
    //     0xA0,
    //     0x0F,
    //     0x69,
    //     0x07,
    //     0x29,
    //     0x0A,
    //     0x0A,
    //     0x90,
    //     0x02,
    //     0xA9,
    //     0xFF,
    //     0xA9,
    //     0x42); // Simple test made by chatgpt, ends with A=66, X=3, Y=15 (Decimal)

    // ADD_INSTRUCTION(0xA9, 0x00, 0xA2, 0xFF, 0xA0, 0x10,
    //     0xA9, 0x05, 0x69, 0x07,
    //     0x69, 0xF5,
    //     0x29, 0x03,
    //     0x29, 0x0E,
    //     0xA9, 0x20, 0x0A,
    //     0xA9, 0xC0, 0x0A,
    //     0xA9, 0x01, 0x90, 0x02, 0xA9, 0xFF, 0xA9, 0x11,
    //     0xA9, 0x80, 0x0A, 0x90, 0x02, 0xA9, 0x22,
    //     0xA2, 0x33, 0xA0, 0x44); // More advanced test made by chatgpt, ends with A=0x22, X=0x33, Y=0x44

    // ADD_INSTRUCTION(
    //     0xA9, 0x00, 0xA2, 0xAA, 0xA0, 0x55,
    //     0xA9, 0x05, 0x69, 0x07, 0xB0, 0x02, 0xA9, 0x11,
    //     0xA9, 0xF0, 0x69, 0x20, 0x90, 0x02, 0xA9, 0x22,
    //     0xA9, 0x20, 0x0A, 0xB0, 0x02, 0xA9, 0x33,
    //     0xA9, 0xC0, 0x0A, 0x90, 0x02, 0xA9, 0x44,
    //     0xA9, 0xFF, 0x29, 0x0F, 0x29, 0xF0
    // ); // ChatGPT again, post BCS test, ends with A=0x00, X=0xAA, Y=0x55

    ADD_INSTRUCTION(
        0xA2, 0xFF, 0x9A,
        0xA9, 0x42, 0x48, 0xA9, 0x00, 0x68,
        0xA9, 0x55, 0x48, 0x68, 0x08, 0xA9, 0x11, 0x28,
        0xA2, 0xAA, 0x9A, 0xA2, 0x00, 0xBA
    ); // ChatGPT Stack test, ends with A=0x11, X=0xAA, SP = 0xAA

    print_context();

    while (mainMemory[context.pc] != 0x00)
    {
        step();
        print_context();
    }

    return 0;
}

